<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WeFix Platform - Contracts</title>
    <!-- SweetAlert2 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f7fa;
            color: #333;
            overflow-x: hidden;
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar Styles */
        .sidebar {
            width: 260px;
            background: linear-gradient(180deg, #32281d 0%, #E67E00 100%);
            color: white;
            padding: 20px 0;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }

        .logo {
            padding: 0 20px 30px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 20px;
        }

        .logo h1 {
            font-size: 28px;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .logo span {
            color: #FCD34D;
        }

        .menu {
            list-style: none;
        }

        .menu-item {
            margin-bottom: 5px;
        }

        .menu-link {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: rgba(255, 255, 255, 0.85);
            text-decoration: none;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }

        .menu-link:hover {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            border-left-color: #FCD34D;
        }

        .menu-link.active {
            background-color: rgba(255, 255, 255, 0.15);
            color: white;
            border-left-color: #FCD34D;
        }

        .menu-icon {
            width: 20px;
            height: 20px;
            margin-right: 12px;
            font-size: 18px;
        }

        .submenu {
            list-style: none;
            max-height: 200px;
            overflow: hidden;
            transition: max-height 0.3s ease;
            background-color: rgba(0, 0, 0, 0.1);
        }

        .submenu.open {
            max-height: 200px;
        }

        .submenu-item {
            padding-left: 52px;
        }

        .submenu-link {
            display: block;
            padding: 10px 20px;
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .submenu-link:hover {
            color: white;
            background-color: rgba(255, 255, 255, 0.05);
            padding-left: 25px;
        }

        .submenu-link.active {
            color: #FCD34D;
            background-color: rgba(255, 255, 255, 0.1);
        }

        /* Main Content Styles */
        .main-content {
            flex: 1;
            margin-left: 260px;
            padding: 30px;
        }

        .header {
            background: white;
            padding: 20px 30px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h2 {
            font-size: 24px;
            font-weight: 600;
            color: #E67E00;
        }

        .btn-add {
            background: linear-gradient(135deg, #F78F1E 0%, #E67E00 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-add:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(247, 143, 30, 0.4);
        }

        .content-area {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        /* Filter Section */
        .filter-section {
            margin-bottom: 25px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-input {
            flex: 1;
            min-width: 250px;
            padding: 10px 16px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
        }

        .filter-select {
            padding: 10px 16px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
            background: white;
            cursor: pointer;
        }

        .filter-select:focus,
        .filter-input:focus {
            outline: none;
            border-color: #F78F1E;
            box-shadow: 0 0 0 3px rgba(247, 143, 30, 0.1);
        }

        .results-count {
            color: #6b7280;
            font-size: 14px;
            margin-left: auto;
        }

        .grid-container {
            overflow-x: auto;
        }

        .grid-header {
            display: grid;
            grid-template-columns: 100px 120px 120px 120px 100px 120px 120px 200px;
            gap: 8px;
            padding: 15px 12px;
            background-color: #f8fafc;
            border-radius: 8px;
            margin-bottom: 10px;
            font-weight: 600;
            color: #E67E00;
            font-size: 13px;
        }

        .grid-header-cell {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            user-select: none;
        }

        .grid-header-cell:hover {
            color: #F78F1E;
        }

        .sort-icon {
            font-size: 12px;
            opacity: 0.5;
        }

        .grid-row {
            display: grid;
            grid-template-columns: 100px 120px 120px 120px 100px 120px 120px 200px;
            gap: 8px;
            padding: 15px 12px;
            border-bottom: 1px solid #e5e7eb;
            transition: all 0.3s ease;
        }

        .grid-row:hover {
            background-color: #f8fafc;
        }

        .grid-cell {
            display: flex;
            align-items: center;
            color: #374151;
            font-size: 14px;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-active {
            background-color: #d1fae5;
            color: #065f46;
        }

        .status-inactive {
            background-color: #fee2e2;
            color: #991b1b;
        }

        .business-model-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            background-color: #dbeafe;
            color: #1e40af;
        }

        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .btn-edit {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-edit:hover {
            background: #2563eb;
        }

        .btn-delete {
            background: #EF4444;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-delete:hover {
            background: #dc2626;
        }

        /* Pagination Styles */
        .pagination-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e5e7eb;
        }

        .pagination-info {
            color: #6b7280;
            font-size: 14px;
        }

        .pagination-controls {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .pagination-btn {
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            background: white;
            color: #374151;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .pagination-btn:hover:not(:disabled) {
            background-color: #f3f4f6;
            border-color: #F78F1E;
        }

        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pagination-btn.active {
            background: linear-gradient(135deg, #F78F1E 0%, #E67E00 100%);
            color: white;
            border-color: #F78F1E;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #9ca3af;
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        /* Modal Popup Styles */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            width: 90%;
            max-width: 700px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            padding: 25px 30px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            background: white;
            z-index: 10;
        }

        .modal-header h3 {
            font-size: 22px;
            color: #E67E00;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 28px;
            color: #9ca3af;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close-btn:hover {
            color: #374151;
        }

        .modal-body {
            padding: 30px;
        }

        .modal-footer {
            padding: 20px 30px;
            border-top: 1px solid #e5e7eb;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #374151;
            font-size: 14px;
        }

        .form-group-required::after {
            content: ' *';
            color: #EF4444;
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
        }

        .form-input:focus {
            outline: none;
            border-color: #F78F1E;
            box-shadow: 0 0 0 3px rgba(247, 143, 30, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-group-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .radio-group {
            display: flex;
            gap: 20px;
        }

        .radio-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .radio-item input[type="radio"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .radio-group.error {
            border: 2px solid #EF4444;
            border-radius: 8px;
            padding: 12px;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.4s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.4s;
            border-radius: 50%;
        }

        .toggle-switch input:checked + .toggle-slider {
            background-color: #F78F1E;
        }

        .toggle-switch input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }

        .count-control {
            display: flex;
            align-items: center;
            gap: 10px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            padding: 4px;
        }

        .count-btn {
            background: #f3f4f6;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .count-btn:hover {
            background: #e5e7eb;
        }

        .count-input {
            border: none;
            width: 60px;
            text-align: center;
            font-size: 14px;
            font-weight: 600;
        }

        .count-input:focus {
            outline: none;
        }

        .file-upload-container {
            border: 2px dashed #d1d5db;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .file-upload-container:hover {
            border-color: #F78F1E;
            background-color: #fff7ed;
        }

        .file-upload-input {
            display: none;
        }

        .file-upload-icon {
            font-size: 48px;
            color: #9ca3af;
            margin-bottom: 10px;
        }

        .file-upload-text {
            color: #6b7280;
            font-size: 14px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #F78F1E 0%, #E67E00 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(247, 143, 30, 0.4);
        }

        .btn-secondary {
            background: #f3f4f6;
            color: #374151;
            border: 1px solid #d1d5db;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            background: #e5e7eb;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }

            .sidebar.mobile-open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .grid-header,
            .grid-row {
                grid-template-columns: 1fr;
            }

            .grid-header-cell {
                display: none;
            }

            .grid-cell {
                display: grid;
                grid-template-columns: 120px 1fr;
                gap: 8px;
            }

            .grid-cell::before {
                content: attr(data-label);
                font-weight: 600;
                color: #E67E00;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo">
                <h1>We<span>Fix</span></h1>
            </div>
            <ul class="menu">
                <li class="menu-item">
                    <a href="index.html" class="menu-link">
                        <span class="menu-icon">üìä</span>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="#" class="menu-link">
                        <span class="menu-icon">üìÖ</span>
                        <span>Calendar</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="tickets.html" class="menu-link">
                        <span class="menu-icon">üé´</span>
                        <span>Tickets</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="#" class="menu-link customers-link">
                        <span class="menu-icon">üë•</span>
                        <span>Customers</span>
                    </a>
                    <ul class="submenu open">
                        <li class="submenu-item">
                            <a href="companies.html" class="submenu-link">Companies</a>
                        </li>
                        <li class="submenu-item">
                            <a href="individuals.html" class="submenu-link">Individuals</a>
                        </li>
                    </ul>
                </li>
                <li class="menu-item">
                    <a href="contracts.html" class="menu-link active">
                        <span class="menu-icon">üìã</span>
                        <span>Contracts</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="permissions.html" class="menu-link">
                        <span class="menu-icon">üîê</span>
                        <span>Permissions</span>
                    </a>
                </li>
            </ul>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="header">
                <h2>Contracts</h2>
                <button class="btn-add" onclick="window.openAddContractModal()">
                    <span>‚ûï</span>
                    <span>Add New Contract</span>
                </button>
            </div>
            <div class="content-area">
                <!-- Filter Section -->
                <div class="filter-section">
                    <input type="text" class="filter-input" id="searchInput" placeholder="Search by contract reference, company...">
                    <select class="filter-select" id="statusFilter">
                        <option value="">All Status</option>
                        <option value="true">Active</option>
                        <option value="false">Inactive</option>
                    </select>
                    <select class="filter-select" id="businessModelFilter">
                        <option value="">All Business Models</option>
                        <option value="B2B">B2B</option>
                        <option value="White Label">White Label</option>
                    </select>
                    <input type="date" class="filter-input" id="startDateFilter" placeholder="Start Date From" style="max-width: 180px;">
                    <input type="date" class="filter-input" id="endDateFilter" placeholder="End Date To" style="max-width: 180px;">
                    <span class="results-count" id="resultsCount">Showing 0 results</span>
                </div>

                <!-- Grid Container -->
                <div class="grid-container">
                    <div class="grid-header">
                        <div class="grid-header-cell" data-sort="reference">Contract Reference</div>
                        <div class="grid-header-cell" data-sort="company">Company</div>
                        <div class="grid-header-cell" data-sort="businessModel">Business Model</div>
                        <div class="grid-header-cell" data-sort="value">Value</div>
                        <div class="grid-header-cell" data-sort="isActive">Status</div>
                        <div class="grid-header-cell" data-sort="startDate">Start Date</div>
                        <div class="grid-header-cell" data-sort="endDate">End Date</div>
                        <div class="grid-header-cell">Actions</div>
                    </div>
                    <div id="contractsGrid">
                        <!-- Contracts will be displayed here -->
                    </div>
                    <!-- Pagination Container -->
                    <div class="pagination-container" id="paginationContainer" style="display: none;">
                        <div class="pagination-info" id="paginationInfo">
                            Showing 0 - 0 of 0
                        </div>
                        <div class="pagination-controls" id="paginationControls">
                            <!-- Pagination buttons will be generated here -->
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Add/Edit Contract Modal -->
    <div class="modal-overlay" id="contractModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="contractModalTitle">Add New Contract</h3>
                <button class="close-btn" onclick="window.closeContractModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="contractForm">
                    <div class="form-group-row">
                        <div class="form-group">
                            <label class="form-label">Contract Reference</label>
                            <input type="text" class="form-input" id="contractReference" placeholder="Cont2025" readonly style="background-color: #f3f4f6;">
                            <small style="color: #6b7280; font-size: 12px; margin-top: 5px; display: block;">
                                Auto-generated
                            </small>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Contract Title</label>
                            <input type="text" class="form-input" id="contractTitle" placeholder="Enter contract title (e.g., Cont2025)" onchange="updateContractReference()">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label form-group-required">Company Name</label>
                        <select class="form-input" id="companyName" required>
                            <option value="">Select Company</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label form-group-required">Business Model</label>
                        <div class="radio-group">
                            <div class="radio-item">
                                <input type="radio" id="businessModelB2B" name="businessModel" value="B2B" required>
                                <label for="businessModelB2B">B2B</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" id="businessModelWhiteLabel" name="businessModel" value="White Label" required>
                                <label for="businessModelWhiteLabel">White Label</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Is Active</label>
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <label class="toggle-switch">
                                <input type="checkbox" id="contractIsActive" checked>
                                <span class="toggle-slider"></span>
                            </label>
                            <span style="color: #374151; font-size: 14px;">Active</span>
                        </div>
                    </div>

                    <div class="form-group-row">
                        <div class="form-group">
                            <label class="form-label"># of Team Leader</label>
                            <div class="count-control">
                                <button type="button" class="count-btn" onclick="window.decrementCount('teamLeaderCount')">‚àí</button>
                                <input type="number" class="count-input" id="teamLeaderCount" value="1" min="1" readonly>
                                <button type="button" class="count-btn" onclick="window.incrementCount('teamLeaderCount')">+</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label"># of Branch</label>
                            <div class="count-control">
                                <button type="button" class="count-btn" onclick="window.decrementCount('branchCount')">‚àí</button>
                                <input type="number" class="count-input" id="branchCount" value="1" min="1" readonly>
                                <button type="button" class="count-btn" onclick="window.incrementCount('branchCount')">+</button>
                            </div>
                        </div>
                    </div>

                    <div class="form-group-row">
                        <div class="form-group">
                            <label class="form-label"># of Preventive Tickets</label>
                            <div class="count-control">
                                <button type="button" class="count-btn" onclick="window.decrementCount('preventiveTicketsCount')">‚àí</button>
                                <input type="number" class="count-input" id="preventiveTicketsCount" value="1" min="0" readonly>
                                <button type="button" class="count-btn" onclick="window.incrementCount('preventiveTicketsCount')">+</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label"># of Corrective Tickets</label>
                            <div class="count-control">
                                <button type="button" class="count-btn" onclick="window.decrementCount('correctiveTicketsCount')">‚àí</button>
                                <input type="number" class="count-input" id="correctiveTicketsCount" value="1" min="0" readonly>
                                <button type="button" class="count-btn" onclick="window.incrementCount('correctiveTicketsCount')">+</button>
                            </div>
                        </div>
                    </div>

                    <div class="form-group-row">
                        <div class="form-group">
                            <label class="form-label">üìÖ Contract Start Date</label>
                            <input type="date" class="form-input" id="contractStartDate">
                        </div>
                        <div class="form-group">
                            <label class="form-label">üìÖ Contract End Date</label>
                            <input type="date" class="form-input" id="contractEndDate">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">üí∞ Contract Value</label>
                        <input type="text" class="form-input" id="contractValue" placeholder="Enter contract value">
                    </div>

                    <div class="form-group">
                        <label class="form-label">üìÑ Contract Files</label>
                        <div class="file-upload-container" onclick="document.getElementById('contractFilesUpload').click()">
                            <div class="file-upload-icon">üìÑ</div>
                            <div class="file-upload-text">Click to upload contract files</div>
                            <div class="file-upload-text" id="contractFilesName" style="display: none; color: #F78F1E;"></div>
                            <input type="file" id="contractFilesUpload" class="file-upload-input" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" multiple>
                        </div>
                        <small style="color: #6b7280; font-size: 12px; margin-top: 5px; display: block;">Supported formats: PDF, DOC, DOCX, JPG, PNG (Multiple files allowed)</small>
                    </div>

                    <div class="form-group">
                        <label class="form-label">üìù Contract Description</label>
                        <textarea class="form-input form-textarea" id="contractDescription" placeholder="Enter contract description or notes" rows="4"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" onclick="window.closeContractModal()">Cancel</button>
                <button type="button" class="btn-primary" onclick="window.saveContract()">Save</button>
            </div>
        </div>
    </div>

    <script>
        // Contract data
        let contracts = [];
        let filteredContracts = [];
        let sortColumn = null;
        let sortDirection = 'asc';
        let currentPage = 1;
        const rowsPerPage = 10;
        let currentEditingContractId = null;

        // Generate contract reference from title
        window.updateContractReference = function() {
            const title = document.getElementById('contractTitle').value.trim();
            const referenceField = document.getElementById('contractReference');
            
            if (title) {
                referenceField.value = title;
            } else {
                referenceField.value = '';
            }
        };

        // Get contract reference from contract object
        function getContractReference(contract) {
            if (contract.reference) {
                return contract.reference;
            }
            if (contract.number && contract.title) {
                return `${contract.number}-${contract.title}`;
            }
            if (contract.number) {
                return contract.number;
            }
            if (contract.title) {
                return contract.title;
            }
            return 'N/A';
        }

        // Sample company names for contracts
        const companyNames = [
            'TechCorp Solutions', 'Global Services Inc', 'Premier Industries', 'Advanced Systems',
            'Enterprise Solutions', 'Mega Corp Ltd', 'Prime Services', 'Dynamic Group',
            'Elite Business', 'Venture Partners', 'Strategic Holdings', 'Modern Enterprise',
            'Future Tech', 'Smart Business', 'Digital Ventures', 'Core Systems',
            'Alpha Industries', 'Beta Corp', 'Gamma Solutions', 'Delta Tech',
            'Omega Group', 'Phoenix Co', 'Apex Industries', 'Summit Corp', 'Peak Solutions'
        ];

        // Generate 25 sample contracts
        function generateSampleContracts() {
            contracts = [];
            for (let i = 1; i <= 25; i++) {
                const randomCompany = companyNames[Math.floor(Math.random() * companyNames.length)];
                const isActive = Math.random() > 0.3; // 70% active
                const businessModel = Math.random() > 0.5 ? 'B2B' : 'White Label';
                const startDate = new Date(2023, Math.floor(Math.random() * 12), Math.floor(Math.random() * 28) + 1);
                const endDate = new Date(2024 + Math.floor(Math.random() * 2), Math.floor(Math.random() * 12), Math.floor(Math.random() * 28) + 1);
                
                const contractNum = String(i).padStart(3, '0');
                const contractTitle = `Cont${2023 + Math.floor(Math.random() * 3)}`;
                contracts.push({
                    id: 'CNT' + String(i).padStart(5, '0'),
                    number: contractNum,
                    title: contractTitle,
                    reference: `${contractNum}-${contractTitle}`,
                    company: randomCompany,
                    businessModel: businessModel,
                    isActive: isActive,
                    teamLeaderCount: Math.floor(Math.random() * 5) + 1,
                    branchCount: Math.floor(Math.random() * 4) + 1,
                    preventiveTicketsCount: Math.floor(Math.random() * 100),
                    correctiveTicketsCount: Math.floor(Math.random() * 50),
                    startDate: startDate.toISOString().split('T')[0],
                    endDate: endDate.toISOString().split('T')[0],
                    value: '$' + (Math.floor(Math.random() * 500000) + 50000).toLocaleString(),
                    description: `Contract description for ${randomCompany} - Sample contract details and terms.`,
                    files: []
                });
            }
        }

        // Save contracts to localStorage
        function saveContractsToStorage() {
            try {
                localStorage.setItem('wefixContracts', JSON.stringify(contracts));
            } catch (error) {
                console.error('Error saving contracts to localStorage:', error);
            }
        }

        // Load contracts from localStorage
        function loadContractsFromStorage() {
            try {
                const storedContracts = localStorage.getItem('wefixContracts');
                if (storedContracts) {
                    return JSON.parse(storedContracts);
                }
            } catch (error) {
                console.error('Error loading contracts from localStorage:', error);
            }
            return null;
        }

        // Filter contracts
        function filterContracts() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const statusFilter = document.getElementById('statusFilter').value;
            const businessModelFilter = document.getElementById('businessModelFilter').value;
            const startDateFilter = document.getElementById('startDateFilter').value;
            const endDateFilter = document.getElementById('endDateFilter').value;

            filteredContracts = contracts.filter(contract => {
                const contractReference = getContractReference(contract).toLowerCase();
                const matchesSearch = !searchTerm || 
                    contractReference.includes(searchTerm) ||
                    contract.number?.toLowerCase().includes(searchTerm) ||
                    contract.title?.toLowerCase().includes(searchTerm) ||
                    contract.company.toLowerCase().includes(searchTerm);
                
                const matchesStatus = !statusFilter || 
                    contract.isActive.toString() === statusFilter;
                
                const matchesBusinessModel = !businessModelFilter || 
                    contract.businessModel === businessModelFilter;
                
                const matchesStartDate = !startDateFilter || 
                    !contract.startDate || contract.startDate >= startDateFilter;
                
                const matchesEndDate = !endDateFilter || 
                    !contract.endDate || contract.endDate <= endDateFilter;

                return matchesSearch && matchesStatus && matchesBusinessModel && matchesStartDate && matchesEndDate;
            });

            currentPage = 1;
            applySorting();
            displayContracts();
        }

        // Apply sorting
        function applySorting() {
            if (!sortColumn) return;

            filteredContracts.sort((a, b) => {
                let aVal, bVal;

                switch(sortColumn) {
                    case 'number':
                        aVal = a.number || '';
                        bVal = b.number || '';
                        break;
                    case 'reference':
                        aVal = getContractReference(a).toLowerCase();
                        bVal = getContractReference(b).toLowerCase();
                        break;
                    case 'company':
                        aVal = a.company.toLowerCase();
                        bVal = b.company.toLowerCase();
                        break;
                    case 'businessModel':
                        aVal = a.businessModel;
                        bVal = b.businessModel;
                        break;
                    case 'value':
                        aVal = parseFloat(a.value.replace(/[^0-9.]/g, '')) || 0;
                        bVal = parseFloat(b.value.replace(/[^0-9.]/g, '')) || 0;
                        break;
                    case 'isActive':
                        aVal = a.isActive ? 1 : 0;
                        bVal = b.isActive ? 1 : 0;
                        break;
                    case 'startDate':
                        aVal = a.startDate || '';
                        bVal = b.startDate || '';
                        break;
                    case 'endDate':
                        aVal = a.endDate || '';
                        bVal = b.endDate || '';
                        break;
                    default:
                        return 0;
                }

                if (aVal < bVal) return sortDirection === 'asc' ? -1 : 1;
                if (aVal > bVal) return sortDirection === 'asc' ? 1 : -1;
                return 0;
            });
        }

        // Handle sort
        function handleSort(column) {
            if (sortColumn === column) {
                sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                sortColumn = column;
                sortDirection = 'asc';
            }

            applySorting();
            displayContracts();
        }

        // Display contracts
        function displayContracts() {
            try {
                const gridContainer = document.getElementById('contractsGrid');
                const resultsCount = document.getElementById('resultsCount');
                const paginationContainer = document.getElementById('paginationContainer');
                
                if (!gridContainer || !resultsCount || !paginationContainer) {
                    console.error('Required DOM elements not found');
                    return;
                }
                
                resultsCount.textContent = `Showing ${filteredContracts.length} results`;

                if (filteredContracts.length === 0) {
                    gridContainer.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">üìã</div>
                            <h3>No contracts found</h3>
                            <p>Try adjusting your filters</p>
                        </div>
                    `;
                    paginationContainer.style.display = 'none';
                    return;
                }

                // Calculate pagination
                const totalPages = Math.ceil(filteredContracts.length / rowsPerPage);
                const startIndex = (currentPage - 1) * rowsPerPage;
                const endIndex = Math.min(startIndex + rowsPerPage, filteredContracts.length);
                const paginatedContracts = filteredContracts.slice(startIndex, endIndex);

                // Display contracts
                gridContainer.innerHTML = paginatedContracts.map(contract => {
                    const contractReference = getContractReference(contract);
                    return `
                    <div class="grid-row">
                        <div class="grid-cell" data-label="Contract Reference">${contractReference}</div>
                        <div class="grid-cell" data-label="Company">${contract.company}</div>
                        <div class="grid-cell" data-label="Business Model">
                            <span class="business-model-badge">${contract.businessModel}</span>
                        </div>
                        <div class="grid-cell" data-label="Value">${contract.value}</div>
                        <div class="grid-cell" data-label="Status">
                            <span class="status-badge ${contract.isActive ? 'status-active' : 'status-inactive'}">
                                ${contract.isActive ? 'Active' : 'Inactive'}
                            </span>
                        </div>
                        <div class="grid-cell" data-label="Start Date">${contract.startDate || 'N/A'}</div>
                        <div class="grid-cell" data-label="End Date">${contract.endDate || 'N/A'}</div>
                        <div class="grid-cell" data-label="Actions">
                            <div class="action-buttons">
                                <button class="btn-edit" onclick="window.editContract('${contract.id}')" title="Edit Contract">
                                    Edit
                                </button>
                                <button class="btn-delete" onclick="window.deleteContract('${contract.id}')" title="Delete Contract">
                                    Delete
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                }).join('');

                // Update pagination info
                document.getElementById('paginationInfo').textContent = 
                    `Showing ${startIndex + 1} - ${endIndex} of ${filteredContracts.length}`;

                // Show pagination controls
                paginationContainer.style.display = 'flex';
                
                // Render pagination buttons
                renderPagination(totalPages);
            } catch (error) {
                console.error('Error in displayContracts:', error);
            }
        }

        // Render pagination controls
        function renderPagination(totalPages) {
            const controls = document.getElementById('paginationControls');
            let buttons = '';

            buttons += `<button class="pagination-btn" onclick="window.goToPage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>Previous</button>`;

            let startPage = Math.max(1, currentPage - 2);
            let endPage = Math.min(totalPages, currentPage + 2);

            if (startPage > 1) {
                buttons += `<button class="pagination-btn" onclick="window.goToPage(1)">1</button>`;
                if (startPage > 2) {
                    buttons += `<span style="padding: 8px 4px;">...</span>`;
                }
            }

            for (let i = startPage; i <= endPage; i++) {
                buttons += `<button class="pagination-btn ${i === currentPage ? 'active' : ''}" onclick="window.goToPage(${i})">${i}</button>`;
            }

            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    buttons += `<span style="padding: 8px 4px;">...</span>`;
                }
                buttons += `<button class="pagination-btn" onclick="window.goToPage(${totalPages})">${totalPages}</button>`;
            }

            buttons += `<button class="pagination-btn" onclick="window.goToPage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>Next</button>`;

            controls.innerHTML = buttons;
        }

        // Go to page
        window.goToPage = function(page) {
            const totalPages = Math.ceil(filteredContracts.length / rowsPerPage);
            if (page >= 1 && page <= totalPages) {
                currentPage = page;
                displayContracts();
                document.getElementById('contractsGrid').scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        // Load companies into dropdown
        function loadCompaniesIntoDropdown() {
            const companySelect = document.getElementById('companyName');
            if (!companySelect) return;
            
            // Keep the first "Select Company" option
            const firstOption = companySelect.querySelector('option[value=""]');
            companySelect.innerHTML = '';
            if (firstOption) {
                companySelect.appendChild(firstOption);
            } else {
                companySelect.innerHTML = '<option value="">Select Company</option>';
            }
            
            try {
                // Load companies from localStorage
                const storedCompanies = localStorage.getItem('wefixCompanies');
                if (storedCompanies) {
                    const companies = JSON.parse(storedCompanies);
                    companies.forEach(company => {
                        const option = document.createElement('option');
                        option.value = company.title || company.nameEn || company.nameAr || '';
                        option.textContent = company.title || company.nameEn || company.nameAr || '';
                        companySelect.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('Error loading companies:', error);
            }
        }

        // Open add contract modal
        window.openAddContractModal = function() {
            currentEditingContractId = null;
            document.getElementById('contractModalTitle').textContent = 'Add New Contract';
            document.getElementById('contractForm').reset();
            document.getElementById('contractIsActive').checked = true;
            document.getElementById('teamLeaderCount').value = 1;
            document.getElementById('branchCount').value = 1;
            document.getElementById('preventiveTicketsCount').value = 1;
            document.getElementById('correctiveTicketsCount').value = 1;
            document.getElementById('contractFilesName').style.display = 'none';
            document.getElementById('contractReference').value = '';
            
            // Load companies into dropdown
            loadCompaniesIntoDropdown();
            
            document.getElementById('contractModal').classList.add('active');
        }

        // Close contract modal
        window.closeContractModal = function() {
            document.getElementById('contractModal').classList.remove('active');
        }

        // Edit contract
        window.editContract = function(contractId) {
            const contract = contracts.find(c => c.id === contractId);
            if (!contract) return;

            currentEditingContractId = contractId;
            document.getElementById('contractModalTitle').textContent = 'Edit Contract';
            
            // Load companies into dropdown first
            loadCompaniesIntoDropdown();
            
            document.getElementById('contractTitle').value = contract.title || '';
            updateContractReference();
            document.getElementById('companyName').value = contract.company;
            document.getElementById('contractIsActive').checked = contract.isActive;
            document.getElementById('teamLeaderCount').value = contract.teamLeaderCount;
            document.getElementById('branchCount').value = contract.branchCount;
            document.getElementById('preventiveTicketsCount').value = contract.preventiveTicketsCount;
            document.getElementById('correctiveTicketsCount').value = contract.correctiveTicketsCount;
            document.getElementById('contractStartDate').value = contract.startDate || '';
            document.getElementById('contractEndDate').value = contract.endDate || '';
            document.getElementById('contractValue').value = contract.value;
            document.getElementById('contractDescription').value = contract.description || '';

            if (contract.businessModel === 'B2B') {
                document.getElementById('businessModelB2B').checked = true;
            } else {
                document.getElementById('businessModelWhiteLabel').checked = true;
            }

            document.getElementById('contractModal').classList.add('active');
        }

        // Delete contract
        window.deleteContract = function(contractId) {
            Swal.fire({
                title: 'Delete Contract',
                text: 'Are you sure you want to delete this contract?',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#EF4444',
                cancelButtonColor: '#6b7280',
                confirmButtonText: 'Yes, delete it!'
            }).then((result) => {
                if (result.isConfirmed) {
                    contracts = contracts.filter(c => c.id !== contractId);
                    saveContractsToStorage();
                    filterContracts();
                    Swal.fire('Deleted!', 'Contract has been deleted.', 'success');
                }
            });
        }

        // Save contract
        window.saveContract = function() {
            const businessModelB2B = document.getElementById('businessModelB2B');
            const businessModelWhiteLabel = document.getElementById('businessModelWhiteLabel');
            const radioGroup = businessModelB2B.closest('.radio-group');
            if (!businessModelB2B.checked && !businessModelWhiteLabel.checked) {
                if (radioGroup) {
                    radioGroup.classList.add('error');
                    setTimeout(() => {
                        radioGroup.classList.remove('error');
                    }, 3000);
                }
                businessModelB2B.focus();
                Swal.fire({
                    icon: 'error',
                    title: 'Validation Error',
                    text: 'Please select a Business Model',
                    confirmButtonColor: '#E67E00'
                });
                return;
            }

            const contractNumber = document.getElementById('contractNumber').value.trim();
            const contractTitle = document.getElementById('contractTitle').value.trim();
            const contractReference = document.getElementById('contractReference').value.trim();
            const companyName = document.getElementById('companyName').value.trim();
            const businessModel = businessModelB2B.checked ? 'B2B' : 'White Label';
            const isActive = document.getElementById('contractIsActive').checked;
            const teamLeaderCount = parseInt(document.getElementById('teamLeaderCount').value) || 1;
            const branchCount = parseInt(document.getElementById('branchCount').value) || 1;
            const preventiveTicketsCount = parseInt(document.getElementById('preventiveTicketsCount').value) || 0;
            const correctiveTicketsCount = parseInt(document.getElementById('correctiveTicketsCount').value) || 0;
            const startDate = document.getElementById('contractStartDate').value;
            const endDate = document.getElementById('contractEndDate').value;
            const value = document.getElementById('contractValue').value;
            const description = document.getElementById('contractDescription').value;

            // Generate reference if not already set
            const finalReference = contractReference || (contractNumber && contractTitle ? `${contractNumber}-${contractTitle}` : (contractNumber || contractTitle || ''));

            if (currentEditingContractId) {
                // Update existing contract
                const contractIndex = contracts.findIndex(c => c.id === currentEditingContractId);
                if (contractIndex !== -1) {
                    contracts[contractIndex] = {
                        ...contracts[contractIndex],
                        number: contractNumber || contracts[contractIndex].number,
                        title: contractTitle || contracts[contractIndex].title,
                        reference: finalReference,
                        company: companyName,
                        businessModel: businessModel,
                        isActive: isActive,
                        teamLeaderCount: teamLeaderCount,
                        branchCount: branchCount,
                        preventiveTicketsCount: preventiveTicketsCount,
                        correctiveTicketsCount: correctiveTicketsCount,
                        startDate: startDate,
                        endDate: endDate,
                        value: value,
                        description: description
                    };
                }
            } else {
                // Add new contract
                const nextId = contracts.length > 0 ? 
                    'CNT' + String(parseInt(contracts[contracts.length - 1].id.replace('CNT', '')) + 1).padStart(5, '0') :
                    'CNT00001';
                const nextNumber = contractNumber || ('CNT-' + String(contracts.length + 1).padStart(4, '0'));
                
                contracts.push({
                    id: nextId,
                    number: nextNumber,
                    title: contractTitle || '',
                    reference: finalReference,
                    company: companyName,
                    businessModel: businessModel,
                    isActive: isActive,
                    teamLeaderCount: teamLeaderCount,
                    branchCount: branchCount,
                    preventiveTicketsCount: preventiveTicketsCount,
                    correctiveTicketsCount: correctiveTicketsCount,
                    startDate: startDate,
                    endDate: endDate,
                    value: value,
                    description: description,
                    files: []
                });
            }

            saveContractsToStorage();
            filterContracts();
            window.closeContractModal();

            Swal.fire({
                icon: 'success',
                title: currentEditingContractId ? 'Contract Updated!' : 'Contract Added!',
                text: 'Contract has been saved successfully',
                confirmButtonColor: '#E67E00',
                timer: 3000,
                timerProgressBar: true
            });
        }

        // Count control functions
        window.incrementCount = function(inputId) {
            const input = document.getElementById(inputId);
            if (input) {
                const currentValue = parseInt(input.value) || 0;
                const minValue = parseInt(input.min) || 0;
                input.value = Math.max(minValue, currentValue + 1);
            }
        }

        window.decrementCount = function(inputId) {
            const input = document.getElementById(inputId);
            if (input) {
                const currentValue = parseInt(input.value) || 0;
                const minValue = parseInt(input.min) || 0;
                input.value = Math.max(minValue, currentValue - 1);
            }
        }

        // File upload handler
        document.getElementById('contractFilesUpload').addEventListener('change', function(e) {
            const fileName = document.getElementById('contractFilesName');
            if (e.target.files.length > 0) {
                fileName.textContent = `${e.target.files.length} file(s) selected`;
                fileName.style.display = 'block';
            } else {
                fileName.style.display = 'none';
            }
        });

        // Event listeners for filtering
        document.getElementById('searchInput').addEventListener('input', filterContracts);
        document.getElementById('statusFilter').addEventListener('change', filterContracts);
        document.getElementById('businessModelFilter').addEventListener('change', filterContracts);
        document.getElementById('startDateFilter').addEventListener('change', filterContracts);
        document.getElementById('endDateFilter').addEventListener('change', filterContracts);

        // Event listeners for sorting
        document.querySelectorAll('.grid-header-cell').forEach(cell => {
            const sortColumn = cell.getAttribute('data-sort');
            if (sortColumn) {
                cell.addEventListener('click', () => handleSort(sortColumn));
            }
        });

        // Initialize
        function initializeContractsPage() {
            try {
                const storedContracts = loadContractsFromStorage();
                if (storedContracts && storedContracts.length > 0) {
                    contracts = storedContracts;
                } else {
                    generateSampleContracts();
                    saveContractsToStorage();
                }
                
                filteredContracts = [...contracts];
                displayContracts();
            } catch (error) {
                console.error('Error initializing contracts page:', error);
            }
        }

        // Run initialization
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeContractsPage);
        } else {
            initializeContractsPage();
        }
    </script>
    <!-- SweetAlert2 JS -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</body>
</html>


